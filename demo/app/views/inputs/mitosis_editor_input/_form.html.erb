<div class="mitosis-editor-wrapper"
     data-input-name="<%= input_html_options[:name] %>"
     data-height="<%= input_html_options[:data][:mit_height] %>"
     data-placeholder="<%= input_html_options[:data][:mit_placeholder] %>">
  <div id="mitosis-editor-<%= input_html_options[:id] %>" class="mitosis-editor-container"></div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
<%= stylesheet_link_tag "mitosis-editor" %>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-typescript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js"></script>
<%= javascript_include_tag "mitosis-editor" %>
<script>
(function() {
  var container = document.getElementById('mitosis-editor-<%= input_html_options[:id] %>');
  var wrapper = container.closest('.mitosis-editor-wrapper');
  var inputName = wrapper.dataset.inputName;
  var height = wrapper.dataset.height || '500px';
  var placeholder = wrapper.dataset.placeholder || '';

  // Find the hidden input
  var hiddenInput = document.querySelector('input[name="' + inputName + '"]');

  // Get MitosisEditor from the global scope
  var MitosisEditor = window.MitosisEditor;

  if (MitosisEditor && MitosisEditor.createEditor) {
    var editor = MitosisEditor.createEditor({
      container: container,
      content: hiddenInput ? hiddenInput.value : '',
      height: height,
      placeholder: placeholder
    });

    // Sync editor content to hidden input on form submit
    var form = container.closest('form');
    if (form) {
      form.addEventListener('submit', function() {
        if (hiddenInput && editor && editor.getMarkdown) {
          hiddenInput.value = editor.getMarkdown();
        }
      });
    }
  }
})();
</script>
